
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Organiser Home</title>

  <!-- bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <!-- custom CSS -->
  <link rel="stylesheet" href="/main.css" />
</head>
<body class="bg-charcoal text-beige">

  <div class="container py-5" style="max-width: 900px;">

    <!-- page header: title and logout button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h1 class="text-heading">Organiser Home Page</h1>

      <form action="/organiser/logout" method="GET">
        <button type="submit" class="btn btn-mocha">Logout</button>
      </form>
    </div>

    <!-- display site name and description from database -->
    <h2 class="text-slate"><%= siteName %></h2>
    <p><%= description %></p>

    <!-- links to site settings and create new event -->
    <p>
      <a href="/site-settings" class="btn btn-slate me-2 mb-3">Site Settings</a>
      <a href="/organiser/new" class="btn btn-mocha mb-3">Create New Event</a>
    </p>

    <!-- published events section -->
    <section class="mb-5">
      <h3 class="text-heading mb-3">Published Events</h3>

      <!-- if there are no published events -->
      <% if (publishedEvents.length === 0) { %>
        <p>No published events yet.</p>
      <% } else { %>
        <ul class="list-group">
          <% publishedEvents.forEach(event => { %>
            <li class="list-group-item bg-slate-box mb-3">

              <!-- display event title and description -->
              <p class="fs-5 fw-semibold text-mocha mb-2">
                <strong>Title:</strong> <span><%= event.title %></span>
              </p>
              <p class="fs-6 fw-semibold"><strong>Description:</strong> <%= event.description || 'No description' %></p>

              <!-- event date/time and metadata -->
              <div class="bg-slate-box date-info-box p-3 mb-4">
                <p class="mb-1"><strong>Date:</strong> <%= event.date %></p>
                <p class="mb-1"><strong>Time:</strong> <%= event.time || 'Not set' %></p>
                <p class="mb-1"><strong>Created On:</strong> <%= event.created_at %></p>
                <p class="mb-1"><strong>Published On:</strong> <%= event.published_at %></p>
                <p class="mb-0"><strong>Last Modified:</strong> <%= event.last_modified || 'Never modified' %></p>
              </div>

              <!-- ticket information -->
              <div class="mb-3">
              <strong>Tickets:</strong>
              <% if (!event.tickets || event.tickets.length === 0) { %>
                No tickets set
              <% } else { %>
                <div class="ticket-grid mt-2">
                  <% event.tickets.forEach(ticket => { %>
                    <div class="ticket-card">
                      <div class="ticket-type"><%= ticket.ticket_type %></div>
                      <div class="ticket-price">$<%= ticket.price.toFixed(2) %></div>
                      <div class="ticket-availability">
                        <%= ticket.remaining %> of <%= ticket.original %> available
                      </div>
                    </div>
                    <% }) %>
                  </div>
              <% } %>
              </div>

              <!-- published event share link and copy button -->
              <p class="mb-1"><strong>Share Link:</strong></p>
              <div class="d-flex align-items-center flex-wrap gap-2 mb-3">
                <input
                type="text"
                class="form-control form-control-sm bg-light text-dark"
                value="http://localhost:3000/attendee/event/<%= event.id %>"
                readonly
                id="event-link-<%= event.id %>"
                style="max-width: 400px;"
                />
                <button
                class="btn btn-sm btn-slate"
                onclick="copyLink('<%= event.id %>')"
                type="button"
                >
                Copy Link
              </button>
            </div>

            <!-- delete button for published event -->
              <form action="/organiser/delete/<%= event.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this event?');" class="mb-0">
                <button type="submit" class="btn btn-mocha btn-sm">Delete</button>
              </form>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </section>

    <!-- draft events section -->
    <section>
      <h3 class="text-heading mb-3">Draft Events</h3>

      <!-- if there are no draft events -->
      <% if (draftEvents.length === 0) { %>
        <p>No draft events yet.</p>
      <% } else { %>
        <ul class="list-group">
          <% draftEvents.forEach(event => { %>
            <li class="list-group-item bg-slate-box mb-3">

              <!-- event info -->
              <p class="fs-5 fw-semibold text-mocha mb-2">
                <strong>Title:</strong> <span><%= event.title %></span>
              </p>
              <p class="fs-6 fw-semibold"><strong>Description:</strong> <%= event.description || 'No description' %></p>

              <!-- metadata block -->
              <div class="bg-slate-box date-info-box p-3 mb-4">
                <p class="mb-1"><strong>Date:</strong> <%= event.date %></p>
                <p class="mb-1"><strong>Time:</strong> <%= event.time || 'Not set' %></p>
                <p class="mb-1"><strong>Created On:</strong> <%= event.created_at %></p>
                <p class="mb-1"><strong>Published On:</strong> <%= event.published_at || 'Not yet published' %></p>
                <p class="mb-0"><strong>Last Modified:</strong> <%= event.last_modified || 'Never modified' %></p>
              </div>

              <!-- ticket details -->
              <div class="mb-3">
              <strong>Tickets:</strong>
              <% if (!event.tickets || event.tickets.length === 0) { %>
                No tickets set
              <% } else { %>
                <div class="ticket-grid mt-2">
                  <% event.tickets.forEach(ticket => { %>
                    <div class="ticket-card">
                      <div class="ticket-type"><%= ticket.ticket_type %></div>
                      <div class="ticket-price">$<%= ticket.price.toFixed(2) %></div>
                      <div class="ticket-availability">
                        <%= ticket.remaining %> of <%= ticket.original %> available
                      </div>
                    </div>
                    <% }) %>
                  </div>
              <% } %>
              </div>

              <!-- action buttons: edit, publish, delete -->
              <div class="d-flex gap-2 flex-wrap">
                <a href="/organiser/edit/<%= event.id %>" class="btn btn-slate btn-sm">Edit</a>

                <form action="/organiser/publish/<%= event.id %>" method="POST" onsubmit="return confirm('Publish this event?');" class="mb-0">
                  <button type="submit" class="btn btn-mocha btn-sm">Publish</button>
                </form>

                <form action="/organiser/delete/<%= event.id %>" method="POST" onsubmit="return confirm('Are you sure you want to delete this draft event?');" class="mb-0">
                  <button type="submit" class="btn btn-mocha btn-sm">Delete</button>
                </form>
              </div>
            </li>
          <% }) %>
        </ul>
      <% } %>
    </section>

    <!-- back button to homepage-->
    <p class="mt-4">
      <a href="/" class="btn btn-slate">Back to Main Home</a>
    </p>
  </div>

  <!-- JS for copying share link -->
  <script>
  function copyLink(eventId) {
    const input = document.getElementById(`event-link-${eventId}`);
    input.select();
    input.setSelectionRange(0, 99999);

    try {
      document.execCommand("copy");
      alert("Link copied to clipboard!");
    } catch (err) {
      alert("Failed to copy link.");
    }
  }
</script>

</body>
</html>